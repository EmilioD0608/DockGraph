<div class="panel-container" [class.collapsed]="!isOpen()">
    <button class="toggle-btn" (click)="toggle()">
        <lucide-icon [img]="isOpen() ? icons.chevronLeft : icons.chevronRight" [size]="20"></lucide-icon>
    </button>

    <div class="panel-content" *ngIf="isOpen()">
        <header class="panel-header">
            <h2>Administración</h2>
        </header>

        <section class="panel-section">
            <h3>Relaciones</h3>

            <div class="create-box">
                <div class="form-group">
                    <label>Origen (Servicio)</label>
                    <select [ngModel]="newConnSourceId()" (ngModelChange)="newConnSourceId.set($event)">
                        <option value="" disabled selected>Seleccionar...</option>
                        <option *ngFor="let node of sources" [value]="node.id">{{ node.label }}</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Destino</label>
                    <select [ngModel]="newConnTargetId()" (ngModelChange)="newConnTargetId.set($event)"
                        [disabled]="!newConnSourceId()">
                        <option value="" disabled selected>Seleccionar...</option>
                        <option *ngFor="let node of targets" [value]="node.id">{{ node.label }}</option>
                    </select>
                </div>

                <button class="btn-primary" (click)="create()" [disabled]="!newConnSourceId() || !newConnTargetId()">
                    <lucide-icon [img]="icons.plus" [size]="16"></lucide-icon>
                    Crear Relación
                </button>
            </div>

            <div class="connections-list">
                <div class="connection-item" *ngFor="let conn of connections">
                    <div class="conn-info">
                        <span class="node-badge source">{{ getNodeLabel(conn.sourceNodeId) }}</span>
                        <lucide-icon [img]="icons.arrowRight" [size]="14" class="arrow-icon"></lucide-icon>
                        <span class="node-badge" [ngClass]="getConnectionClass(conn)">{{ getNodeLabel(conn.targetNodeId)
                            }}</span>
                    </div>

                    <div class="conn-actions">
                        <input #nameInput type="text" placeholder="Nombre de referencia..." [ngModel]="conn.name"
                            (blur)="updateName(conn, nameInput.value)" class="name-input">
                        <button class="btn-icon delete" (click)="deleteConn(conn.id)" title="Eliminar">
                            <lucide-icon [img]="icons.trash" [size]="16"></lucide-icon>
                        </button>
                    </div>
                </div>

                <div *ngIf="connections.length === 0" class="empty-state">
                    No hay relaciones creadas
                </div>
            </div>
        </section>
    </div>
</div>